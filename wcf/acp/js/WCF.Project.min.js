WCF.Project={};WCF.Project.Version={};WCF.Project.Version.Switch=Class.extend({_proxy:null,init:function(){$('.jsSwitchButton').click($.proxy(this._switchVersion,this));this._proxy=new WCF.Action.Proxy({showLoadingOverlay:true,success:$.proxy(this._success,this)})},_switchVersion:function(event){var $button=$(event.target);this._proxy.setOption('data',{actionName:'switchToVersion',className:'wcf\\data\\project\\version\\ProjectVersionAction',objectIDs:[$button.data('objectID')]});this._proxy.sendRequest()},_success:function(data,textStatus,jqXHR){location.reload()}});WCF.Project.Activate=Class.extend({});WCF.Project.Deactivate=Class.extend({});WCF.Project.Table={};WCF.Project.Table.Filter=Class.extend({_input:null,_rows:null,_dataRows:null,_categoryRows:null,_categorySelector:'',_rowspanDataField:'',_disjunctiveFiltering:false,_cachedQuery:'',_typingTimer:null,_doneTypingInterval:50,_isFilterIndexCreated:false,init:function(input,table,categorySelector,rowspanDataField,disjunctiveFiltering){this._input=$(input);this._categorySelector=categorySelector;if(rowspanDataField!=null)this._rowspanDataField=rowspanDataField;if(disjunctiveFiltering)this._disjunctiveFiltering=true;this._rows=$(table).find("tbody tr");if(this._categorySelector!=null){this._dataRows=this._rows.filter(':not('+this._categorySelector+')');this._categoryRows=this._rows.filter(this._categorySelector)}else{this._dataRows=this._rows}this._input.keyup($.proxy(this._startTimer,this));this._input.keydown($.proxy(this._abortTimer,this));if((typeof this._input.val())!="undefined"&&this._input.val().length!=0){if(!this._isFilterIndexCreated){this._createIndex()}this.filter()}},_startTimer:function(){this._abortTimer();this._typingTimer=setTimeout($.proxy(this.filter,this),this._doneTypingInterval);if(!this._isFilterIndexCreated)this._createIndex()},_abortTimer:function(){clearTimeout(this._typingTimer)},filter:function(){var self=this;var $time=$.now();if(this._input.val().length==0){this._rows.show();return}var query=this._input.val().toLowerCase();var queryParts=query.split(" ");if(this._cachedQuery==query)return;else this._cachedQuery=query;this._rows.hide();this._dataRows.filter(function(i,v){var $row=$(this);if(typeof $row.data('filterIndex')==='undefined'){return}var text=$row.data('filterIndex');for(var d=0;d<queryParts.length;d++){if(queryParts[d].length==0)continue;if(text.indexOf(queryParts[d])>=0){if(self._disjunctiveFiltering)return true}else{if(!self._disjunctiveFiltering)return false}}return!self._disjunctiveFiltering}).each(function(i,v){var $row=$(this);$row.show();if(self._categoryRows.length>0){var $category=$row.prev(self._categorySelector);if($category.length==0)$category=$row.prevUntil(self._categorySelector).last().prev();if($category.length==1)$category.show()}if(self._rowspanDataField.length>0){var rowspanDataFieldValue=$row.data(self._rowspanDataField);var $next=$row;while(($next=$next.next()).data(self._rowspanDataField)==rowspanDataFieldValue){$next.show()}}});this._doneTypingInterval=$.now()-$time},_createIndex:function(){this._isFilterIndexCreated=true;var self=this;var prevRowspanDataFieldValue='';var currentCategoryText='';var text='';this._rows.each(function(){var $row=$(this);if(self._categorySelector!=null&&$row.is(self._categorySelector)){currentCategoryText=$.trim($row.text())}else{if(self._rowspanDataField.length>0){var rowspanDataFieldValue=$row.data(self._rowspanDataField);if(prevRowspanDataFieldValue!=rowspanDataFieldValue){prevRowspanDataFieldValue=rowspanDataFieldValue;text=$.trim($row.add($row.nextUntil(':not([data-'+self._rowspanDataField+'="'+rowspanDataFieldValue+'"])')).text())}else{return}}else{text=$.trim($row.text())}text=(currentCategoryText+text).toLowerCase();$row.data('filterIndex',text)}})}});WCF.Project.Table.SpannedRowHighlight=Class.extend({_id:'object-id',_className:'hover',init:function(table,id,className){if(id!=null)this._id=id;if(className!=null)this._className=className;var $self=this;$(table+" td").hover(function(){var $row=$(this).parent();var $rows=$row.parent().find('[data-'+$self._id+'="'+$row.data($self._id)+'"]');$rows.addClass($self._className)},function(){var $row=$(this).parent();var $rows=$row.parent().find('[data-'+$self._id+'="'+$row.data($self._id)+'"]');$rows.removeClass($self._className)})},});WCF.Project.Table.Sortable=Class.extend({_className:'',_containerID:'',_container:null,_categoryDataField:'',_categorySelector:'',_blockAboveFirstCategory:'',_orderName:'',_proxy:null,init:function(data){this._containerID=$.wcfEscapeID(data.containerID);this._container=$('#'+this._containerID+' .sortableList');this._className=data.className;this._categoryDataField=(data.categoryDataField?data.categoryDataField:'');this._categorySelector=(data.categorySelector?data.categorySelector:'');this._blockAboveFirstCategory=(this._categorySelector.length>0&&data.blockAboveFirstCategory);this._orderName=(data.orderName?data.orderName:'showOrder');this._proxy=new WCF.Action.Proxy();this._container.sortable({axis:'y',cancel:'.sortableNoSorting',connectWith:this._container,doNotClear:true,errorClass:'sortableInvalidTarget',forcePlaceholderSize:true,helper:$.proxy(this._helper,this),opacity:.6,placeholder:'sortablePlaceholder',tolerance:'pointer',items:'tr'+(this._blockAboveFirstCategory?':not('+this._categorySelector+':first-child)':''),update:$.proxy(this._update,this)})},_helper:function(event,ui){$('#'+this._containerID+' thead th').each(function(){$(this).width($(this).width())});ui.children().each(function(){$(this).width($(this).width())});return ui},_update:function(event,ui){var $row=$(ui.item.context);if($row.hasClass('deleted'))return;var objectID=$row.data('objectID');var oldCategoryName=$row.data(this._categoryDataField);var isHidden=$row.data('isHidden');var $prev=$row.prev();var $next=$row.next();var newCategoryName='';if($prev.length>0){newCategoryName=$prev.data(this._categoryDataField)}else{if($next.filter(':not('+this._categorySelector+')').length>0){newCategoryName=$next.data(this._categoryDataField)}}$row.data(this._categoryDataField,newCategoryName);if(isHidden){if(oldCategoryName!=newCategoryName){var data={};data[this._categoryDataField]=newCategoryName;this._proxy.setOption('data',{actionName:'update',className:this._className,objectIDs:[objectID],parameters:data});this._proxy.sendRequest()}}else{var data={};var counter={};var categoryDataField=this._categoryDataField;$rows=this._container.find('tr'+(this._categorySelector.length>0?':not('+this._categorySelector+')':'')).filter(function(index){return	$(this).data(this._orderName)!==-1&&!$(this).hasClass('deleted')&&($(this).data(categoryDataField)===newCategoryName||$(this).data(categoryDataField)===oldCategoryName)});counter[newCategoryName]=0;counter[oldCategoryName]=0;var orderName=this._orderName;$rows.each(function(i,v){var $v=$(v);if(!$v.data('is-hidden')){var vCategoryName=$v.data(categoryDataField);if(!$v.data('auto-'+orderName)){$v.children('.column'+orderName.charAt(0).toUpperCase()+orderName.slice(1)).text(counter[vCategoryName])}$v.data(orderName,counter[vCategoryName]);data[$v.data('objectID')]={};data[$v.data('objectID')][orderName]=counter[vCategoryName];data[$v.data('objectID')][categoryDataField]=vCategoryName;counter[vCategoryName]++}});this._proxy.setOption('data',{actionName:'update',className:this._className,objectIDs:Object.keys(data),parameters:{dataPerObject:true,data:data,}});this._proxy.sendRequest()}}});WCF.Project.Action={};WCF.Project.Action.Delete=WCF.Action.Delete.extend({_rowspanDataField:[],init:function(className,containerSelector,buttonSelector,rowspanDataField){this._super(className,containerSelector,buttonSelector);if(rowspanDataField!=null){this._rowspanDataField[buttonSelector]=rowspanDataField}},_initElements:function(){$(this._containerSelector).each((function(index,container){var $container=$(container);var $containerID=$container.wcfIdentify();if(!WCF.inArray($containerID,this._containers[this._buttonSelector])){var $deleteButton=$container.find(this._buttonSelector);if($deleteButton.length){if(this._containers[this._buttonSelector]==undefined){this._containers[this._buttonSelector]=[]}this._containers[this._buttonSelector].push($containerID);$deleteButton.click($.proxy(this._click,this))}}}).bind(this))},_sendRequest:function(object){var $object=$(object);var objectIDs=null;if($object.attr('data-object-ids')){objectIDs=$object.data('object-ids')}else{objectIDs=[$object.data('object-id')]}this.proxy.setOption('data',{actionName:'delete',className:this._className,objectIDs:objectIDs});this.proxy.sendRequest()},_success:function(data,textStatus,jqXHR){this.triggerEffect(data.returnValues)},triggerEffect:function(objectIDs){for(var pip in objectIDs){var deleteButtonSelector='.js'+pip+'DeleteButton';for(var $index in this._containers[deleteButtonSelector]){var $container=$('#'+this._containers[deleteButtonSelector][$index]);var $button=$container.find(deleteButtonSelector);if($button.length&&WCF.inArray($button.data('objectID'),objectIDs[pip])){var $counter=$container.parents('.projectTabularBox').find('.badgeCounter');$counter.text($counter.text()-1);if(this._rowspanDataField[deleteButtonSelector]!=undefined){$id=$container.data(this._rowspanDataField[deleteButtonSelector]);$($.find('[data-'+this._rowspanDataField[deleteButtonSelector]+'="'+$id+'"]')).addClass('deleted')}else{$container.addClass('deleted')}}}}},});WCF.Project.Action.Delete.Database=WCF.Project.Action.Delete.extend({init:function(){containerSelector='.jsDatabaseTableRow, .jsDatabaseColumnRow, .jsDatabaseIndexRow, .jsDatabaseForeignKeyRow';this._super('wcf\\data\\project\\database\\log\\ProjectDatabaseLogAction',containerSelector,'.jsDatabaseDeleteButton')}});WCF.Project.Database={};WCF.Project.Database.IndexAddTable=Class.extend({_options:{axis:'xy',helper:'clone',opacity:.5,placeholder:'sortablePlaceholder',tolerance:'pointer',items:'li'},init:function(){this._options=$.extend(true,{receive:$.proxy(this._receive,this),},this._options);$('#sqlTable').change($.proxy(function(){$('#availableColumns ul').hide();$('#selectedColumns ul').hide();var $tableName=$('#sqlTable').val();var $availableColumns=$('#availableColumns ul[data-table-name="'+$tableName+'"]');var $selectedColumns=$('#selectedColumns ul[data-table-name="'+$tableName+'"]');if(!$availableColumns.hasClass('ui-sortable')){var $container=$availableColumns.add($selectedColumns);$container.sortable(this._options,{connectWith:$container})}$availableColumns.show();$selectedColumns.show()},this));$('#sqlTable').change()},_receive:function(event,ui){var disable=($(event.target)==$('#availableColumns'));$(ui.item).find('input').prop("disabled",disable)}});WCF.Project.Database.ForeignKeyAddTable=WCF.Project.Database.IndexAddTable.extend({init:function(){this._options=$.extend(true,{start:$.proxy(this._start,this),stop:$.proxy(this._stop,this)},this._options);this._super();$('#sqlTable').change($.proxy(function(){this._start();this._stop()},this));$('#referencedSqlTable').change($.proxy(function(){$('#availableReferencedColumns ul').hide();$('#selectedReferencedColumns ul').hide();var $tableName=$('#referencedSqlTable').val();var $availableColumns=$('#availableReferencedColumns ul[data-table-name="'+$tableName+'"]');var $selectedColumns=$('#selectedReferencedColumns ul[data-table-name="'+$tableName+'"]');if(!$availableColumns.hasClass('ui-sortable')){var $container=$availableColumns.add($selectedColumns);$container.sortable(this._options,{connectWith:$container})}$availableColumns.show();$selectedColumns.show();this._start();this._stop()},this));$('#referencedSqlTable').change()},_receive:function(event,ui){var $target=$(event.target);var disable=($target.parent('#availableColumns').length||$target.parent('#availableReferencedColumns').length);$(ui.item).find('input').prop("disabled",disable)},_start:function(event,ui){var $tableName=$('#sqlTable').val();var $referencedSqlTable=$('#referencedSqlTable').val();$('#selectedColumns ul[data-table-name="'+$tableName+'"] li').removeClass('matching notMatching');$('#selectedReferencedColumns ul[data-table-name="'+$referencedSqlTable+'"] li').removeClass('matching notMatching')},_stop:function(event,ui){var $tableName=$('#sqlTable').val();var $referencedSqlTable=$('#referencedSqlTable').val();var $columns=$('#selectedColumns ul[data-table-name="'+$tableName+'"] li');var $referencedColumns=$('#selectedReferencedColumns ul[data-table-name="'+$referencedSqlTable+'"] li');$columns.each(function(index,item){if($referencedColumns.get(index)){var $column=$(item);var $referencedColumn=$($referencedColumns.get(index));if($column.find('input').data('type')==$referencedColumn.find('input').data('type')){$column.addClass('matching');$referencedColumn.addClass('matching')}else{$column.addClass('notMatching');$referencedColumn.addClass('notMatching')}}})},});